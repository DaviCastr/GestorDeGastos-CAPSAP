sap.ui.define(["sap/m/MessageToast","sap/ui/model/json/JSONModel"],function(e,t){"use strict";return{excluirTransacao:function(e){var t=e.getSource().getParent();var n=this.getParent().getParent();var a=n.byId("idTransacao").getValue();var r=n.byId("identificadorTransacao").getValue();var s=n.byId("excluirTransacoesRelacionadas").getSelected();let o=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.Table")&&e.getId().includes("i18nTransaescompras-innerTable")});let i=o[0];let c=this.getBindingContext().getValue();if(sap.ui.getCore().oFatura){c=sap.ui.getCore().oFatura}var u={fatura:c.ID,transacao:a,identificador:r,excluirRelacionadas:s};t.setBusy(true);var l=()=>new Promise((e,a)=>{fetch("/Gerenciamento",{method:"GET",headers:{"X-CSRF-Token":"Fetch"}}).then(function(e){if(!e.ok){throw new Error("Erro ao obter CSRF Token")}return e}.bind(this)).then(function(e){const t=e.headers.get("X-CSRF-Token");return t}.bind(this)).then(function(r){fetch("/Gerenciamento/excluirTransacao",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":r},body:JSON.stringify(u)}).then(function(e){if(!e.ok){throw new Error("Erro ao excluir transação.")}return e.json()}).then(function(a){let r=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.Table")&&e.getId().includes("innerTable")});if(r.length){let e=r[0];e.refreshItems();const t=this.getBindingContext();t.refresh()}let s=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.VBox")&&e.getId().includes("FaturaAtualVBox")});if(s.length){let e=s[0];e.getBindingContext().refresh()}n.byId("excluirTransacoesRelacionadas").setSelected(false);sap.m.MessageToast.show("Transação excluída com sucesso.");t.setBusy(false);t.close();e()}.bind(this)).catch(function(e){t.setBusy(false);sap.m.MessageToast.show("Erro: "+e.message);a()})}.bind(this)).catch(function(e){sap.m.MessageToast.show("Erro ao obter csrf token: "+e);a()})});let d={busy:{set:true,check:true},dataloss:{popup:true,navigation:false}};let g=this.getParent().getParent().getController().getExtensionAPI().getEditFlow();g.securedExecution(l,d).finally(e=>{console.log(e)})},cancelarExclusao:function(e){this.getParent().close()}}});
//# sourceMappingURL=ExcluirTransacao.js.map