sap.ui.define(["apps/dflc/gestaogastos/ext/fragment/AtualizaInformacoesDaTela","sap/ui/core/Fragment"],function(e,t){return{formatter:{formatDate:function(e){if(!e){return""}const t=new Date(`${e}T00:00:00`);const a=String(t.getDate()).padStart(2,"0");const r=String(t.getMonth()+1).padStart(2,"0");const n=t.getFullYear();return`${a}/${r}/${n}`}},excluirTransacao:function(a){var r=a.getSource().getParent();var n=this.getParent().getParent();var o=n.getModel();var s=t.byId("ExcluirTransacaoFragment","idTransacao").getValue();var i=t.byId("ExcluirTransacaoFragment","identificadorTransacao").getValue();var c=t.byId("ExcluirTransacaoFragment","excluirTransacoesRelacionadas").getSelected();let u=this.getBindingContext()?.getValue()||null;if(sap.ui.getCore().oFatura){u=sap.ui.getCore().oFatura}if(!u){sap.m.MessageToast.show("Erro ao obter dados");return}var l={fatura:u.ID,transacao:s,identificador:i,excluirRelacionadas:c};r.setBusy(true);var g=function(){return new Promise(function(a,s){fetch(o.getServiceUrl(),{method:"GET",headers:{"X-CSRF-Token":"Fetch"}}).then(function(e){if(!e.ok){throw new Error("Erro ao obter CSRF Token")}return e}.bind(this)).then(function(e){const t=e.headers.get("X-CSRF-Token");return t}.bind(this)).then(function(i){fetch(`${o.getServiceUrl()}excluirTransacao`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":i},body:JSON.stringify(l)}).then(function(e){if(!e.ok){throw new Error("Erro ao excluir transação.")}return e.json()}).then(async function(o){e.AtualizaInformacoes(n);t.byId("ExcluirTransacaoFragment","excluirTransacoesRelacionadas").setSelected(false);sap.m.MessageToast.show("Transação excluída com sucesso.");r.setBusy(false);r.close();a()}.bind(this)).catch(function(e){r.setBusy(false);sap.m.MessageToast.show("Erro: "+e.message);s()})}.bind(this)).catch(function(e){r.setBusy(false);sap.m.MessageToast.show("Erro ao obter csrf token: "+e);s()})}.bind(this))}.bind(this);let d={busy:{set:true,check:true},dataloss:{popup:true,navigation:false}};let f=this.getParent().getParent().getController().getExtensionAPI().getEditFlow();f.securedExecution(g,d).finally(e=>{console.log(e)})},cancelarExclusao:function(e){this.getParent().close()}}});
//# sourceMappingURL=ExcluirTransacao.js.map