<<<<<<< HEAD
sap.ui.define(["apps/dflc/gestaogastos/ext/fragment/AtualizaInformacoesDaTela","sap/ui/core/Fragment"],function(e,t){return{formatter:{formatDate:function(e){if(!e){return""}const t=new Date(`${e}T00:00:00`);const a=String(t.getDate()).padStart(2,"0");const r=String(t.getMonth()+1).padStart(2,"0");const n=t.getFullYear();return`${a}/${r}/${n}`}},excluirTransacao:function(a){var r=a.getSource().getParent();var n=this.getParent().getParent();var o=n.getModel();var s=t.byId("ExcluirTransacaoFragment","idTransacao").getValue();var i=t.byId("ExcluirTransacaoFragment","identificadorTransacao").getValue();var c=t.byId("ExcluirTransacaoFragment","excluirTransacoesRelacionadas").getSelected();let u=this.getBindingContext()?.getValue()||null;if(sap.ui.getCore().oFatura){u=sap.ui.getCore().oFatura}if(!u){sap.m.MessageToast.show("Erro ao obter dados");return}var l={fatura:u.ID,transacao:s,identificador:i,excluirRelacionadas:c};r.setBusy(true);var g=function(){return new Promise(function(a,s){fetch(o.getServiceUrl(),{method:"GET",headers:{"X-CSRF-Token":"Fetch"}}).then(function(e){if(!e.ok){throw new Error("Erro ao obter CSRF Token")}return e}.bind(this)).then(function(e){const t=e.headers.get("X-CSRF-Token");return t}.bind(this)).then(function(i){fetch(`${o.getServiceUrl()}excluirTransacao`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":i},body:JSON.stringify(l)}).then(function(e){if(!e.ok){throw new Error("Erro ao excluir transação.")}return e.json()}).then(async function(o){e.AtualizaInformacoes(n);t.byId("ExcluirTransacaoFragment","excluirTransacoesRelacionadas").setSelected(false);sap.m.MessageToast.show("Transação excluída com sucesso.");r.setBusy(false);r.close();a()}.bind(this)).catch(function(e){r.setBusy(false);sap.m.MessageToast.show("Erro: "+e.message);s()})}.bind(this)).catch(function(e){r.setBusy(false);sap.m.MessageToast.show("Erro ao obter csrf token: "+e);s()})}.bind(this))}.bind(this);let d={busy:{set:true,check:true},dataloss:{popup:true,navigation:false}};let f=this.getParent().getParent().getController().getExtensionAPI().getEditFlow();f.securedExecution(g,d).finally(e=>{console.log(e)})},cancelarExclusao:function(e){this.getParent().close()}}});
=======
sap.ui.define(["sap/m/MessageToast","sap/ui/model/json/JSONModel"],function(e,t){"use strict";return{excluirTransacao:function(e){var t=e.getSource().getParent();var n=this.getParent().getParent();var a=n.byId("idTransacao").getValue();var r=n.byId("identificadorTransacao").getValue();var s=n.byId("excluirTransacoesRelacionadas").getSelected();let o=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.Table")&&e.getId().includes("i18nTransaescompras-innerTable")});let i=o[0];let c=this.getBindingContext().getValue();if(sap.ui.getCore().oFatura){c=sap.ui.getCore().oFatura}var u={fatura:c.ID,transacao:a,identificador:r,excluirRelacionadas:s};t.setBusy(true);var l=()=>new Promise((e,a)=>{fetch("/Gerenciamento",{method:"GET",headers:{"X-CSRF-Token":"Fetch"}}).then(function(e){if(!e.ok){throw new Error("Erro ao obter CSRF Token")}return e}.bind(this)).then(function(e){const t=e.headers.get("X-CSRF-Token");return t}.bind(this)).then(function(r){fetch("/Gerenciamento/excluirTransacao",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":r},body:JSON.stringify(u)}).then(function(e){if(!e.ok){throw new Error("Erro ao excluir transação.")}return e.json()}).then(function(a){let r=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.Table")&&e.getId().includes("innerTable")});if(r.length){let e=r[0];e.refreshItems();const t=this.getBindingContext();t.refresh()}let s=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.VBox")&&e.getId().includes("FaturaAtualVBox")});if(s.length){let e=s[0];e.getBindingContext().refresh()}n.byId("excluirTransacoesRelacionadas").setSelected(false);sap.m.MessageToast.show("Transação excluída com sucesso.");t.setBusy(false);t.close();e()}.bind(this)).catch(function(e){t.setBusy(false);sap.m.MessageToast.show("Erro: "+e.message);a()})}.bind(this)).catch(function(e){sap.m.MessageToast.show("Erro ao obter csrf token: "+e);a()})});let d={busy:{set:true,check:true},dataloss:{popup:true,navigation:false}};let g=this.getParent().getParent().getController().getExtensionAPI().getEditFlow();g.securedExecution(l,d).finally(e=>{console.log(e)})},cancelarExclusao:function(e){this.getParent().close()}}});
>>>>>>> 7f01fe1936688df1011ce89337a57e281209142a
//# sourceMappingURL=ExcluirTransacao.js.map