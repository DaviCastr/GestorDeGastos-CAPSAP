sap.ui.define(["sap/ui/comp/valuehelpdialog/ValueHelpDialog","sap/ui/model/Filter","sap/ui/model/FilterOperator","apps/dflc/gestaogastos/ext/fragment/AtualizaInformacoesDaTela"],function(e,a,t,s){"use strict";return{onInit:function(e){console.log(e)},onCancelarGasto:function(e){this.getParent().close()},onAdicionarGasto:async function(e){try{const e=this.getParent().getParent();const g=this.getParent();g.setBusy(true);var a=e.byId("descricaoGastoInput");var t=e.byId("valorGastoInput");var o=e.byId("moedaGastoInput");var l=e.byId("dataGastoPicker");var r=e.byId("gastoFixoCheckBox");var i=e.byId("totalParcelasInput");var n=e.byId("cartaoSelect");var u=e.byId("categoriaSelect");var c=true;if(!a.getValue()){a.setValueState("Error");c=false}else if(a.getValue()==" "){a.setValueState("Error");c=false}else{a.setValueState("None")}if(!t.getValue()){t.setValueState("Error");c=false}else if(t.getValue()==0){t.setValueState("Error");c=false}else if(t.getValue()<0){t.setValueState("Error");c=false}else{t.setValueState("None")}if(!o.getValue()){o.setValueState("Error");c=false}else{let a=e.getModel("Moedas").getData().filter(e=>[o.getValue()].includes(e.code));if(a.length==0){o.setValueState("Error");c=false}else{o.setValueState("None")}}if(!l.getValue()){l.setValueState("Error");c=false}else{l.setValueState("None")}if(!i.getValue()){i.setValueState("Error");c=false}else if(i.getValue()==0){i.setValueState("Error");c=false}else{i.setValueState("None")}if(!n.getSelectedKey()){n.setValueState("Error");c=false}else{n.setValueState("None")}if(!u.getSelectedKey()){u.setValueState("Error");c=false}else{u.setValueState("None")}if(!c){sap.m.MessageToast.show("Por favor, preencha todos os campos obrigatórios.");g.setBusy(false);return}if(r.getSelected()&&i.getValue()>1){sap.m.MessageToast.show("Quando o gasto é fixo a parcela deve ser igual a 1");g.setBusy(false);return}const p=e.byId("descricaoGastoInput").getValue();const f=e.byId("valorGastoInput").getValue();const V=e.byId("moedaGastoInput").getValue();const m=e.byId("dataGastoPicker").getValue();const S=e.byId("totalParcelasInput").getValue();const h=e.byId("gastoFixoCheckBox").getSelected();const y=e.byId("cartaoSelect").getSelectedKey();const b=e.byId("categoriaSelect").getSelectedKey();const I=m.split("/");const v=`${I[2]}-${I[1]}-${I[0]}`;var d=new Date(m.split("/").reverse().join("-"));if(isNaN(d.getTime())){l.setValueState("Error");sap.m.MessageToast.show("Data inválida. Por favor, insira uma data válida.");g.setBusy(false);return}const P={pessoa:this.getBindingContext().getValue().ID,descricao:p,valor:parseFloat(f),moeda:V,data:v,parcelas:parseInt(S,10),gastofixo:h,categoria:b,cartao:y};let w="adicionarGasto";const x=e.getModel().bindContext(`/${w}(...)`);x.setParameter("pessoa",P.pessoa);x.setParameter("descricao",P.descricao);x.setParameter("valor",P.valor);x.setParameter("moeda",P.moeda);x.setParameter("data",P.data);x.setParameter("parcelas",P.parcelas);x.setParameter("gastofixo",P.gastofixo);x.setParameter("categoria",P.categoria);x.setParameter("cartao",P.cartao);await x.execute();g.setBusy(false);const D=x.getBoundContext();let M=D.getProperty("sucesso");if(M){a.setValue("");t.setValue(0);l.setValue("");i.setValue(1);r.setSelected(false);s.AtualizaInformacoes(e);sap.m.MessageToast.show("Gasto adicionado com sucesso!")}else if(D.getProperty("erro")){sap.m.MessageToast.show("Data inválida!")}}catch(e){console.log("Erro:"+e)}},onValueHelpRequest:function(s){var o=this.getParent().getParent().getParent().getParent();if(!this._oValueHelpDialog){this._oValueHelpDialog=new e({title:"Selecione a Moeda",supportMultiselect:false,key:"code",width:"200px",descriptionKey:"descr",supportRanges:false,filterMode:true,basicSearchText:"",ok:function(e){var a=e.getParameter("tokens");if(a.length>0){var t=a[0].getKey();o.byId("moedaGastoInput").setValue(t)}this._oValueHelpDialog.close()}.bind(this),cancel:function(){this._oValueHelpDialog.close()}.bind(this)});this._oValueHelpDialog.setFilterBar(new sap.ui.comp.filterbar.FilterBar({basicSearch:new sap.m.SearchField({placeholder:"Buscar...",liveChange:function(e){var s=e.getParameter("newValue");var o=new a({filters:[new a("code",t.Contains,s),new a("name",t.Contains,s)],and:false});l.getBinding("rows").filter(o)}})}));var l=this._oValueHelpDialog.getTable();l.setModel(o.getModel("Moedas"));l.bindRows("Moedas>/");l.addColumn(new sap.ui.table.Column({label:new sap.m.Label({text:"Código"}),template:new sap.m.Text({text:"{Moedas>code}"})}));l.addColumn(new sap.ui.table.Column({label:new sap.m.Label({text:"Descrição"}),template:new sap.m.Text({text:"{Moedas>descr}"})}));o.addDependent(this._oValueHelpDialog)}this._oValueHelpDialog.open()}}});
//# sourceMappingURL=AdicionarGasto.js.map