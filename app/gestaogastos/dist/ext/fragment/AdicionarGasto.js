sap.ui.define(["sap/m/MessageToast","sap/ui/comp/valuehelpdialog/ValueHelpDialog","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,a,s){"use strict";return{onInit:function(e){console.log(e)},onCancelarGasto:function(e){this.getParent().close()},onAdicionarGasto:function(e){const t=this.getParent().getParent();const a=this.getParent();a.setBusy(true);var s=t.byId("descricaoGastoInput");var o=t.byId("valorGastoInput");var l=t.byId("moedaGastoInput");var n=t.byId("dataGastoPicker");var r=t.byId("totalParcelasInput");var i=t.byId("cartaoSelect");var u=true;if(!s.getValue()){s.setValueState("Error");u=false}else if(s.getValue()==" "){s.setValueState("Error");u=false}else{s.setValueState("None")}if(!o.getValue()){o.setValueState("Error");u=false}else if(o.getValue()==0){o.setValueState("Error");u=false}else{o.setValueState("None")}if(!l.getValue()){l.setValueState("Error");u=false}else{let e=t.getModel("Moedas").getData().filter(e=>[l.getValue()].includes(e.code));if(e.length==0){l.setValueState("Error");u=false}else{l.setValueState("None")}}if(!n.getValue()){n.setValueState("Error");u=false}else{n.setValueState("None")}if(!r.getValue()){r.setValueState("Error");u=false}else if(r.getValue()==0){r.setValueState("Error");u=false}else{r.setValueState("None")}if(!i.getSelectedKey()){i.setValueState("Error");u=false}else{i.setValueState("None")}if(!u){sap.m.MessageToast.show("Por favor, preencha todos os campos obrigatórios.");a.setBusy(false);return}const c=t.byId("descricaoGastoInput").getValue();const d=t.byId("valorGastoInput").getValue();const g=t.byId("moedaGastoInput").getValue();const p=t.byId("dataGastoPicker").getValue();const f=t.byId("totalParcelasInput").getValue();const h=t.byId("cartaoSelect").getSelectedKey();const V=p.split("/");const m=`${V[2]}-${V[1]}-${V[0]}`;var b=new Date(p.split("/").reverse().join("-"));if(isNaN(b.getTime())){n.setValueState("Error");sap.m.MessageToast.show("Data inválida. Por favor, insira uma data válida.");a.setBusy(false);return}const S={pessoa:this.getBindingContext().getValue().ID,descricao:c,valor:parseFloat(d),moeda:g,data:m,parcelas:parseInt(f,10),cartao:h};var y=()=>new Promise((e,t)=>{fetch("/Gerenciamento",{method:"GET",headers:{"X-CSRF-Token":"Fetch"}}).then(function(e){if(!e.ok){throw new Error("Erro ao obter CSRF Token")}return e}.bind(this)).then(function(e){const t=e.headers.get("X-CSRF-Token");return t}.bind(this)).then(function(l){fetch("/Gerenciamento/adicionarGasto",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":l},body:JSON.stringify(S)}).then(async function(t){a.setBusy(false);if(!t.ok){throw new Error("Erro ao adicionar gasto")}let l=await t.json();s.setValue("");o.setValue(0);n.setValue("");r.setValue(1);let i=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.Table")&&e.getId().includes("innerTable")});let u=i[0];u.refreshItems();const c=this.getBindingContext();c.refresh();a.close();sap.m.MessageToast.show("Gasto adicionado com sucesso!");e()}.bind(this)).catch(e=>{sap.m.MessageToast.show(e.message);a.setBusy(false);t()})}.bind(this)).catch(function(e){sap.m.MessageToast.show("Erro ao obter csrf token: "+e);t()})});let w={busy:{set:true,check:true},dataloss:{popup:true,navigation:false}};let I=this.getParent().getParent().getController().getExtensionAPI().getEditFlow();I.securedExecution(y,w).finally(e=>{console.log(e)})},onValueHelpRequest:function(e){var o=this.getParent().getParent().getParent().getParent();if(!this._oValueHelpDialog){this._oValueHelpDialog=new t({title:"Selecione a Moeda",supportMultiselect:false,key:"code",width:"200px",descriptionKey:"descr",supportRanges:false,filterMode:true,basicSearchText:"",ok:function(e){var t=e.getParameter("tokens");if(t.length>0){var a=t[0].getKey();o.byId("moedaGastoInput").setValue(a)}this._oValueHelpDialog.close()}.bind(this),cancel:function(){this._oValueHelpDialog.close()}.bind(this)});this._oValueHelpDialog.setFilterBar(new sap.ui.comp.filterbar.FilterBar({basicSearch:new sap.m.SearchField({placeholder:"Buscar...",liveChange:function(e){var t=e.getParameter("newValue");var o=new a({filters:[new a("code",s.Contains,t),new a("name",s.Contains,t)],and:false});l.getBinding("rows").filter(o)}})}));var l=this._oValueHelpDialog.getTable();l.setModel(o.getModel("Moedas"));l.bindRows("Moedas>/");l.addColumn(new sap.ui.table.Column({label:new sap.m.Label({text:"Código"}),template:new sap.m.Text({text:"{Moedas>code}"})}));l.addColumn(new sap.ui.table.Column({label:new sap.m.Label({text:"Descrição"}),template:new sap.m.Text({text:"{Moedas>descr}"})}));o.addDependent(this._oValueHelpDialog)}this._oValueHelpDialog.open()}}});
//# sourceMappingURL=AdicionarGasto.js.map