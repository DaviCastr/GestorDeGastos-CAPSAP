sap.ui.define(["sap/m/MessageToast"],function(e){"use strict";return{onUploadImage:async function(){const e=this.byId("FileUploadDetailsCartao");const t=this._view.getBindingContext().getPath();const a=this._view.getBindingContext().getObject();const r=this._view.getModel();const o=e.oFileUpload.files;const s=o[0];let n=async function(){return await new Promise((e,t)=>{fetch(r.getServiceUrl(),{method:"GET",headers:{"X-CSRF-Token":"Fetch"}}).then(function(e){if(!e.ok){throw new Error("Erro ao obter CSRF Token")}return e}.bind(this)).then(function(e){const t=e.headers.get("X-CSRF-Token");return t}.bind(this)).then(function(t){e(t)}).catch(e=>{t(e)})})};e.removeAllHeaderParameters();let i=await n();e.addHeaderParameter(new sap.ui.unified.FileUploaderParameter({name:"x-csrf-token",value:i}));var l=new sap.ui.unified.FileUploaderParameter({name:"If-Match",value:a["@odata.etag"]||"*"});e.insertHeaderParameter(l);var c=new sap.ui.unified.FileUploaderParameter({name:"Content-Type",value:s.type});e.insertHeaderParameter(c);const d=r.getServiceUrl();e.setUploadUrl(`${d}${t.replace("/","")}/Imagem`);e.setSendXHR(true);const u=new Promise((t,a)=>{this.uploadPromises=this.uploadPromises||{};this.uploadPromises[e.getId()]={resolve:t,reject:a};e.upload()});this.editFlow.syncTask(u)},onUploadCompleto:async function(t){try{const r=this.getModel();const o=t.getParameter("responseRaw");const s=t.getParameter("status");const n=t.getSource();const i=n.oFileUpload.files;const l=i[0];const c=this.byId("avatarImagemCartao");var a=this.byId("uploadImagemCartao");a.setPercentValue(0);a.setDisplayValue("0%");a.setVisible(false);if(s!=204){let t=JSON.parse(o);e.show(`Erro:${t.error.message}-${t.error.target}`)}else{if(l){const t=new FileReader;t.onload=t=>{const a=t.target.result;c.setSrc(a);let r=this._view.getBindingContext().getObject().ID;let o=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.Avatar")&&e.getBadgeTooltip().includes(r)});if(o.length>0){o[0].setSrc(a)}e.show("Imagem carregada com sucesso.")};t.readAsDataURL(l)}}}catch(t){e.show("Erro desconhecido:"+t)}},onUploadProgresso(e){var t=e.getParameter("loaded");var a=e.getParameter("total");var r=Math.round(t/a*100);var o=this.byId("uploadImagemCartao");o.setVisible(true);o.setPercentValue(r);o.setDisplayValue(r+"%")},onDeleteImage:function(){this._view.getBindingContext().setProperty("/Imagem",null);e.show("Imagem exclu√≠da.")}}});
//# sourceMappingURL=ImagemCartao.js.map