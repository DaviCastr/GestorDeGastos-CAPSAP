sap.ui.define(["apps/dflc/gestaogastos/ext/fragment/AnaliseCategoriaPessoa"],function(e){"use strict";return{onInit:function(e){console.log(e)},"onBuscarSimulação":function(t){try{let t=this.getModel();var o=function(){return new Promise(function(o,s){let a=this.byId("ListaAno").getSelectedItem().getText();let n=this.byId("ListaMes").getSelectedItem().getText();const r={pessoa:this.getBindingContext().getObject().ID,mes:n,ano:a};try{fetch(t.getServiceUrl(),{method:"GET",headers:{"X-CSRF-Token":"Fetch"}}).then(function(e){if(!e.ok){throw new Error("Erro ao obter CSRF Token")}return e}.bind(this)).then(function(e){const t=e.headers.get("X-CSRF-Token");return t}.bind(this)).then(function(i){fetch(`${t.getServiceUrl()}simulaPorMesAno`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":i},body:JSON.stringify(r)}).then(async function(s){console.log(s);let i=await s.json();let c=this.byId("TotalDoMes");let l=this.byId("TotalDeGastos");let m=this.byId("ValorAEconomizar");c.setNumber(i.TotalDoMes);c.setUnit(i.Moeda_code);l.setNumber(i.TotalDeGastos);l.setUnit(i.Moeda_code);m.setNumber(i.ValorAEconomizar);m.setUnit(i.Moeda_code);let d="recuperaCategorias",u=t.bindContext(`/${d}(...)`);let h=function(t,o,s){let r=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.FlexBox")&&e.getId().includes(`${t}`)});if(r.length>0){if(o?.Categorias){r=r[0];const t=[];o.Categorias.forEach(r=>{const i=r.TotalCategoria||0;const c=r.Porcentagem;const l=new sap.m.GenericTile({id:`Previsao::${r.ID}::${crypto.randomUUID()}`,header:r.Nome,subheader:`${i} ${o.Moeda}`,press:function(t){if(!s){e.onPressPrevisao(t,a,n)}else{e.onPressPrevisaoTotal(t,a,n)}}.bind(this),frameType:"OneByOne",tileContent:[new sap.m.TileContent({footer:`Gasto: ${c.toFixed(2)}%`,content:new sap.m.HBox({items:[new sap.m.Avatar({src:r?.Imagem||null,displaySize:"XS"}),new sap.suite.ui.microchart.RadialMicroChart({size:sap.m.Size.S,percentage:c,valueColor:c>20?"Error":"Good",alignContent:"Center"})]})})]});t.push(l)});r.removeAllItems();if(t.length==0){r.addItem(new sap.m.Label({text:"Não há categorias com gastos nesse Mês"}))}else{t.forEach((e,o)=>{r.addItem(e);if(o<t.length-1){r.addItem(new sap.m.Label({text:"  --  "}))}})}r.setBusy(false)}else{r[0].removeAllItems();r[0].addItem(new sap.m.Label({text:"Não há categorias com gastos nesse Mês"}))}}};u.setParameter("pessoa",r.pessoa);u.setParameter("mes",r.mes);u.setParameter("ano",r.ano);await u.execute();let g=u.getBoundContext().getValue();h("categoryPrevisao",g);d="recuperaCategoriasParaGastoTotal",u=t.bindContext(`/${d}(...)`);u.setParameter("pessoa",r.pessoa);u.setParameter("mes",r.mes);u.setParameter("ano",r.ano);await u.execute();g=u.getBoundContext().getValue();h("categoryPrevisaoTotal",g,true);o()}.bind(this)).catch(function(e){sap.m.MessageToast.show("Erro ao chamar serviço: "+e);s()})}.bind(this)).catch(function(e){sap.m.MessageToast.show("Erro ao obter csrf token: "+e);s()})}catch(e){sap.m.MessageToast.show("Erro ao chamar serviço: "+e.message)}}.bind(this))}.bind(this);let s={busy:{set:true,check:true},dataloss:{popup:true,navigation:false}};this.editFlow.securedExecution(o,s).finally(e=>{console.log(e)})}catch(e){sap.m.MessageToast.show("Erro ao buscar dados"+e)}}}});
//# sourceMappingURL=PrevisaoDeGasto.js.map