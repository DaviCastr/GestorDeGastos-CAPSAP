sap.ui.define(["sap/m/MessageToast","sap/ui/model/json/JSONModel"],function(e,t){"use strict";return{onUploadImage:async function(){const e=this.byId("FileUploadDetails");const t=this._view.getBindingContext().getPath();const a=this._view.getBindingContext().getObject();const s=this._view.getModel();const r=e.oFileUpload.files;const o=r[0];let n=async function(){return await new Promise((e,t)=>{fetch(s.getServiceUrl(),{method:"GET",headers:{"X-CSRF-Token":"Fetch"}}).then(function(e){if(!e.ok){throw new Error("Erro ao obter CSRF Token")}return e}.bind(this)).then(function(e){const t=e.headers.get("X-CSRF-Token");return t}.bind(this)).then(function(t){e(t)}).catch(e=>{t(e)})})};e.removeAllHeaderParameters();let i=await n();e.addHeaderParameter(new sap.ui.unified.FileUploaderParameter({name:"x-csrf-token",value:i}));var l=new sap.ui.unified.FileUploaderParameter({name:"If-Match",value:a["@odata.etag"]||"*"});e.insertHeaderParameter(l);var c=new sap.ui.unified.FileUploaderParameter({name:"Content-Type",value:o.type});e.insertHeaderParameter(c);const d=s.getServiceUrl();e.setUploadUrl(`${d}${t.replace("/","")}/Imagem`);e.setSendXHR(true);const u=new Promise((t,a)=>{this.uploadPromises=this.uploadPromises||{};this.uploadPromises[e.getId()]={resolve:t,reject:a};e.upload()});this.editFlow.syncTask(u)},onUploadCompleto:async function(t){try{const s=this.getModel();const r=t.getParameter("responseRaw");const o=t.getParameter("status");const n=t.getSource();const i=n.oFileUpload.files;const l=i[0];const c=this.byId("avatarImagemPessoa");var a=this.byId("uploadImagemPessoa");a.setPercentValue(0);a.setDisplayValue("0%");a.setVisible(false);if(o!=204){let t=JSON.parse(r);e.show(`Erro:${t.error.message}-${t.error.target}`)}else{if(l){const t=new FileReader;t.onload=t=>{const a=t.target.result;c.setSrc(a);let s=this._view.getBindingContext().getObject().ID;let r=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.Avatar")&&e.getBadgeTooltip().includes(s)});if(r.length>0){r[0].setSrc(a)}let o=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.Table")&&e.getId().includes("Cartes-innerTable")});if(o.lehngth>0){o[0].getModel().refreash()}e.show("Imagem carregada com sucesso.")};t.readAsDataURL(l)}}}catch(t){e.show("Erro desconhecido:"+t)}},onUploadProgresso(e){var t=e.getParameter("loaded");var a=e.getParameter("total");var s=Math.round(t/a*100);var r=this.byId("uploadImagemPessoa");r.setVisible(true);r.setPercentValue(s);r.setDisplayValue(s+"%")},onDeleteImage:function(){this._view.getBindingContext().setProperty("/Imagem",null);e.show("Imagem exclu√≠da.")}}});
//# sourceMappingURL=ImagemPessoa.js.map