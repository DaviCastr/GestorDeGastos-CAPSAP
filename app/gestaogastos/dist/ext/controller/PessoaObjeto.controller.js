sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/ui/model/json/JSONModel"],function(e,t,s,a){"use strict";return e.extend("apps.dflc.gestaogastos.ext.controller.PessoaObjeto",{override:{onInit:function(){var e=this.base.getExtensionAPI().getModel()},onAfterRendering:function(e){let t=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.ui.layout.form.FormElement")&&e.getId().includes("Imagem")});let s=t[0]},routing:{onAfterBinding:async function(e){let a=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.Table")&&e.getId().includes("innerTable")});let o=a[0];let n=await e.requestObject(e.getPath());const i=this.base.getExtensionAPI();const r=[];var l=()=>new Promise((e,a)=>{try{const o={Pessoa_ID:n.ID};fetch(`/Gerenciamento/Cartao?$filter=Pessoa_ID eq ${o.Pessoa_ID}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(async function(a){let o=await a.json();let l;if(Array.isArray(o.value))l=o.value;else l=[o.value];let c=(new Date).toLocaleString("pt-BR",{timeZone:"America/Sao_Paulo"});c=c.replaceAll(","," ");let[u,g,p]=c.split(" ")[0].split("/");l.forEach(e=>{if(e.DiaVencimento-u>=0&&e.DiaVencimento-u<2){if(r.length==0){r.push(new t({type:s.Warning,message:`A fatura do cartão ${e.NomeCartao} está vencendo`}))}}});if(n.TotalDoMes>n.ObjetivoDeGasto&&r.length==0){r.push(new t({type:s.Warning,message:"Seu gasto está acima do seu objetivo de gasto mensal"}))}if(n.TotalDoMes>n.Renda&&r.length==0){r.push(new t({type:s.Warning,message:"Seu gasto está acima mensal está superior a sua renda, fique de olho e reduza seus gastos!"}))}i.showMessages(r);e()}.bind(this)).catch(function(e){sap.m.MessageToast.show("Erro:"+e);a()})}catch(e){sap.m.MessageToast.show("Erro ao chamar serviço: "+e.message)}});let c={busy:{set:true,check:true},dataloss:{popup:true,navigation:false}};this.base.getExtensionAPI().editFlow.securedExecution(l,c).finally(e=>{console.log(e)})}}}})});
//# sourceMappingURL=PessoaObjeto.controller.js.map