sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/ui/model/json/JSONModel"],function(e,t,s,a){"use strict";return e.extend("apps.dflc.gestaogastos.ext.controller.PessoaObjeto",{defineAvisos:async function(e){let a=await e.requestObject(e.getPath());if(!a.ID){do{await this.wait();a=await e.requestObject(e.getPath())}while(!a.ID)}const o=this.base.getExtensionAPI();const n=[];var i=()=>new Promise((e,i)=>{try{const r={Pessoa_ID:a.ID};fetch(`/Gerenciamento/Cartao?$filter=Pessoa_ID eq ${r.Pessoa_ID}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(async function(i){let r=await i.json();let c;if(Array.isArray(r.value))c=r.value;else c=[r.value];let l=(new Date).toLocaleString("pt-BR",{timeZone:"America/Sao_Paulo"});l=l.replaceAll(","," ");let[u,g,p]=l.split(" ")[0].split("/");c.forEach(e=>{if(e.DiaVencimento-u>=0&&e.DiaVencimento-u<2){if(n.length==0){n.push(new t({type:s.Warning,message:`A fatura do cartão ${e.NomeCartao} está vencendo`}))}}});if(a.TotalDoMes>a.ObjetivoDeGasto&&n.length==0){n.push(new t({type:s.Warning,message:"Seu gasto está acima do seu objetivo de gasto mensal"}))}if(a.TotalDoMes>a.Renda&&n.length==0){n.push(new t({type:s.Warning,message:"Seu gasto está acima mensal está superior a sua renda, fique de olho e reduza seus gastos!"}))}o.showMessages(n);e()}.bind(this)).catch(function(e){sap.m.MessageToast.show("Erro:"+e);i()})}catch(e){sap.m.MessageToast.show("Erro ao chamar serviço: "+e.message)}});let r={busy:{set:true,check:true},dataloss:{popup:true,navigation:false}};this.base.getExtensionAPI().editFlow.securedExecution(i,r).finally(e=>{console.log(e)})},sleep:function(e){return new Promise(t=>setTimeout(t,e))},wait:async function(){await this.sleep(500)},override:{onInit:function(){var e=this.base.getExtensionAPI().getModel()},onAfterRendering:function(e){let t=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.ui.layout.form.FormElement")&&e.getId().includes("Imagem")});let s=t[0]},routing:{onAfterBinding:async function(e){this.defineAvisos(e)}}}})});
//# sourceMappingURL=PessoaObjeto.controller.js.map