sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/model/json/JSONModel","sap/ui/core/Fragment"],function(e,t,i){"use strict";return e.extend("apps.dflc.gestaogastos.ext.controller.CartaoObjeto",{defineModeloFaturaAtual:async function(e){let t=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.Panel")&&e.getId().includes("PainelSemFatura")});let i=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.Panel")&&e.getId().includes("PainelFatura")||e.getId().includes("PainelTransacoes")});let a=sap.ui.core.Element.registry.filter(function(e){return e.isA("sap.m.VBox")&&e.getId().includes("FaturaAtualVBox")});if(Array.isArray(t)){t[0].setVisible(false)}if(Array.isArray(i)){i.forEach(e=>{e.setVisible(false)})}let n=a[0];n.setBusy(true);let r=await e.requestObject(e.getPath());if(!r.ID){do{await this.wait();r=await e.requestObject(e.getPath())}while(!r.ID)}const s=this.getView();const o="Fatura";const l=r.ID;let u=(new Date).toLocaleString("pt-BR",{timeZone:"America/Sao_Paulo"});u=u.replaceAll(","," ");let[c,f,d]=u.split(" ")[0].split("/");c=Number(c);f=Number(f);d=Number(d);const p=s.getModel();if(r.DiaFechamento<=c){if(f<12){f+=1}else{f=1;d+=1}}let m=[new sap.ui.model.Filter("Cartao_ID",sap.ui.model.FilterOperator.EQ,l),new sap.ui.model.Filter("Ano",sap.ui.model.FilterOperator.EQ,d),new sap.ui.model.Filter("Mes",sap.ui.model.FilterOperator.EQ,f)];p.bindList("/Fatura",null,null,m).requestContexts().then(async function(e){if(e.length>0){const t=e[0];n.bindElement(t.getPath());if(Array.isArray(i)){i.forEach(e=>{e.setVisible(true)})}n.setBusy(false)}else{if(Array.isArray(t)){t[0].setVisible(true)}n.setBusy(false);console.warn("Nenhuma fatura encontrada.")}}.bind(this)).catch(e=>{console.error("Erro ao buscar a fatura:",e)})},sleep:function(e){return new Promise(t=>setTimeout(t,e))},wait:async function(){await this.sleep(500)},override:{onInit:function(){var e=this.base.getExtensionAPI().getModel()},onBeforeRendering:async function(e){},onAfterRendering:function(e){},routing:{onAfterBinding:async function(e){this.defineModeloFaturaAtual(e)},onBeforeBinding:async function(e){}}}})});
//# sourceMappingURL=CartaoObjeto.controller.js.map